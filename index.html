<!DOCTYPE html>
<html>
<head>
<style>
#buttons {
        position: absolute;
        top: 150px;
        left: 380px;
      }
</style>
<title>Memory</title>
<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
<script>
  	
  	var sb=[2500];
    var bb= [0];
    var blockb=[sb,bb];
    
    var sw=[2500];
    var bw= [0];
    var blockw=[sw,bw];
    
    var sf=[2500];
    var bf= [0];
    var blockf=[sf,bf];
    
    var ext=[0];
    
    var pro = 1;
    var num=0;
    var flag;
    var next;
    var del;
    var flagb,flagw,flagf;
    var timer;
    
    window.onload=function() {
    var mycontext1=document.getElementById("bestfit").getContext('2d');
    var mycontext2=document.getElementById("worstfit").getContext('2d');
    var mycontext3=document.getElementById("firstfit").getContext('2d');
    var mycontext4=document.getElementById("text1").getContext('2d');
    var mycontext5=document.getElementById("text2").getContext('2d');
    var mycontext6=document.getElementById("text3").getContext('2d');
    
    next=Math.floor(Math.random()*400);
    if(next<150)
    	next += 150;
    flag = 1;
    
    function showBestfit()
    {
    	var sum = 0;
    	for(var i=0; i<blockb[0].length; i++)
    	{
    		r = blockb[0][i]/2;
    		mycontext1.fillStyle='yellow'; 
    		mycontext1.fillRect(sum,0,r,100);
    		mycontext1.strokeStyle='black';
    		mycontext1.strokeRect(sum,0,r,100);
    		mycontext1.fillStyle='black';
    		mycontext1.font = '15pt Calibri';
    		mycontext1.textAlign='center'; 
    		mycontext1.fillText( r*2 + 'KB', sum+r/2, 50);
    		sum += r;
    	}
    }
    
    function showWorstfit()
    {
    	var sum = 0;
    	for(var i=0; i<blockw[0].length; i++)
    	{
    		r = blockw[0][i]/2;
    		mycontext2.fillStyle='yellow'; 
    		mycontext2.fillRect(sum,0,r,100);
    		mycontext2.strokeStyle='black';
    		mycontext2.strokeRect(sum,0,r,100);
    		mycontext2.fillStyle='black';
    		mycontext2.font = '15pt Calibri';
    		mycontext2.textAlign='center'; 
    		mycontext2.fillText( r*2 + 'KB', sum+r/2, 50);
    		sum += r;
    	}
    }
    
    function showFirstfit()
    {
    	var sum = 0;
    	for(var i=0; i<blockf[0].length; i++)
    	{
    		r = blockf[0][i]/2;
    		mycontext3.fillStyle='yellow'; 
    		mycontext3.fillRect(sum,0,r,100);
    		mycontext3.strokeStyle='black';
    		mycontext3.strokeRect(sum,0,r,100);
    		mycontext3.fillStyle='black';
    		mycontext3.font = '15pt Calibri';
    		mycontext3.textAlign='center'; 
    		mycontext3.fillText( r*2 + 'KB', sum+r/2, 50);
    		sum += r;
    	}
    }
    
    function mmsg()
  	{
  		var mycontext7=document.getElementById("main").getContext('2d');
  		mycontext7.fillStyle='white';
  		mycontext7.fillRect(0,0,500,200);
  		mycontext7.strokeStyle='black';
    	mycontext7.strokeRect(0,0,500,200);
  		mycontext7.fillStyle='black';
  		mycontext7.font = '15pt Calibri';
  		mycontext7.fillText( 'Next: Add ' + next + 'KB', 100, 100);
    }
    
    showBestfit();
	showWorstfit();
    showFirstfit();
    mmsg();
    
    mycontext4.font = '15pt Calibri';
    mycontext4.fillText( 'Best Fit', 20, 45);
    mycontext5.font = '15pt Calibri';
    mycontext5.fillText( 'Worst Fit', 20, 45);
    mycontext6.font = '15pt Calibri';
    mycontext6.fillText( 'First Fit', 20, 45);
   	}
  
  	function showBestfit()
    {
    	var mycontext1=document.getElementById("bestfit").getContext('2d');
    	var sum = 0;
    	for(var i=0; i<blockb[0].length; i++)
    	{
    		r = blockb[0][i]/2;
    		if(blockb[1][i]==0)
    		{
    			mycontext1.fillStyle='yellow'; 
    			mycontext1.fillRect(sum,0,r,100);
    			mycontext1.strokeStyle='black';
    			mycontext1.strokeRect(sum,0,r,100);
    			mycontext1.fillStyle='black';
    			mycontext1.font = '15pt Calibri';
    			mycontext1.textAlign='center'; 
    			mycontext1.fillText( r*2 + 'KB', sum+r/2, 50);
    		}
    		else
    		{
    			mycontext1.fillStyle='red';
    			mycontext1.fillRect(sum,0,r,100);
    			mycontext1.strokeStyle='black';
    			mycontext1.strokeRect(sum,0,r,100);
    			mycontext1.fillStyle='black';
    			mycontext1.font = '15pt Calibri';
    			mycontext1.textAlign='center';
    			mycontext1.fillText( 'ID:' + blockb[1][i], sum+r/2, 30); 
    			mycontext1.fillText( r*2 + 'KB', sum+r/2, 60);
    		}
    		
    		sum += r;
    	}
    }
    
    function showWorstfit()
    {
    	var mycontext2=document.getElementById("worstfit").getContext('2d');
    	var sum = 0;
    	for(var i=0; i<blockw[0].length; i++)
    	{
    		r = blockw[0][i]/2;
    		if(blockw[1][i]==0)
    		{
    			mycontext2.fillStyle='yellow'; 
    			mycontext2.fillRect(sum,0,r,100);
    			mycontext2.strokeStyle='black';
    			mycontext2.strokeRect(sum,0,r,100);
    			mycontext2.fillStyle='black';
    			mycontext2.font = '15pt Calibri';
    			mycontext2.textAlign='center'; 
    			mycontext2.fillText( r*2 + 'KB', sum+r/2, 50);
    		}
    		else
    		{
    			mycontext2.fillStyle='red';
    			mycontext2.fillRect(sum,0,r,100);
    			mycontext2.strokeStyle='black';
    			mycontext2.strokeRect(sum,0,r,100);
    			mycontext2.fillStyle='black';
    			mycontext2.font = '15pt Calibri';
    			mycontext2.textAlign='center';
    			mycontext2.fillText( 'ID:' + blockw[1][i], sum+r/2, 30); 
    			mycontext2.fillText( r*2 + 'KB', sum+r/2, 60);
    		}
    		sum += r;
    	}
    }
    
    function showFirstfit()
    {
    	var mycontext3=document.getElementById("firstfit").getContext('2d');
    	var sum = 0;
    	for(var i=0; i<blockf[0].length; i++)
    	{
    		r = blockf[0][i]/2;
    		if(blockf[1][i]==0)
    		{
    			mycontext3.fillStyle='yellow'; 
    			mycontext3.fillRect(sum,0,r,100);
    			mycontext3.strokeStyle='black';
    			mycontext3.strokeRect(sum,0,r,100);
    			mycontext3.fillStyle='black';
    			mycontext3.font = '15pt Calibri';
    			mycontext3.textAlign='center'; 
    			mycontext3.fillText( r*2 + 'KB', sum+r/2, 50);
    		}
    		else
    		{
    			mycontext3.fillStyle='red';
    			mycontext3.fillRect(sum,0,r,100);
    			mycontext3.strokeStyle='black';
    			mycontext3.strokeRect(sum,0,r,100);
    			mycontext3.fillStyle='black';
    			mycontext3.font = '15pt Calibri';
    			mycontext3.textAlign='center';
    			mycontext3.fillText( 'ID:' + blockf[1][i], sum+r/2, 30); 
    			mycontext3.fillText( r*2 + 'KB', sum+r/2, 60);
    		}
    		sum += r;
    	}
    }
    
    function add(val)
    {
    	flagb = 0;
    	var min=2500;
      	for(var i=0; i<blockb[0].length; i++)
      	{
        	if(blockb[0][i]>=val && blockb[0][i]<min && blockb[1][i]==0)
          		min = blockb[0][i];
      	}
    	for(var i=0; i<blockb[0].length; i++)
    	{
    		if(blockb[0][i] == min)
    		{
    			for(var j=blockb[0].length; j>i; j--)
    			{
    				blockb[0][j] = blockb[0][j-1];
    				blockb[1][j] = blockb[1][j-1];
    			}
    			
    			blockb[0][i+1] = blockb[0][i]-val;
    			blockb[1][i+1] = 0;
    			
    			blockb[0][i] = val;
    			blockb[1][i] = pro;
    			flagb=1;
    			break;
    		}
    	}

	  flagw = 0;
	  var max = 0;
      for(var i=0; i<blockw[0].length; i++)
      {
        if(blockw[0][i]>=val && blockw[0][i]>max && blockw[1][i]==0)
          max = blockw[0][i];
      }
      
    	for(var i=0; i<blockw[0].length; i++)
    	{
    		if(blockw[0][i] == max)
    		{
    			for(var j=blockw[0].length; j>i; j--)
    			{
    				blockw[0][j] = blockw[0][j-1];
    				blockw[1][j] = blockw[1][j-1];
    			}
    			
    			blockw[0][i+1] = blockw[0][i]-val;
    			blockw[1][i+1] = 0;
    			
    			blockw[0][i] = val;
    			blockw[1][i] = pro;
    			flagw = 1;
    			break;
    		}
    	}
    	
    	flagf = 0;
    	for(var i=0; i<blockf[0].length; i++)
    	{
    		if(blockf[0][i] >= val && blockf[1][i]==0)
    		{
    			for(var j=blockf[0].length; j>i; j--)
    			{
    				blockf[0][j] = blockf[0][j-1];
    				blockf[1][j] = blockf[1][j-1];
    			}
    			
    			blockf[0][i+1] = blockf[0][i]-val;
    			blockf[1][i+1] = 0;
    			
    			blockf[0][i] = val;
    			blockf[1][i] = pro;
    			flagf = 1;
    			break;
    		}
    	}
    	ext.push(1);
    	pro++;
    	num++;
    	
    	if(flagb==0 && flagw==0 && flagf==0)
    		alert("Best fit & Worst fit & First fit have no more block for this process. Please kick 'clear' to restart.");
    	else if(flagb==0 && flagw==0)
    		alert("Best fit & Worst fit have no more block for this process. Please kick 'clear' to restart.");
    	else if(flagw==0 && flagf==0)
    		alert("Worst fit & First fit have no more block for this process. Please kick 'clear' to restart.");
    	else if(flagb==0 && flagf==0)
    		alert("Best fit & First fit have no more block for this process. Please kick 'clear' to restart.");
    	else if(flagb==0 )
    		alert("Best fit has no more block for this process. Please kick 'clear' to restart.");
    	else if(flagw==0 )
    		alert("Worst fit has no more block for this process. Please kick 'clear' to restart.");
    	else if(flagf==0 )
    		alert("First fit has no more block for this process. Please kick 'clear' to restart.");
    }
    
    function sub(val)
    {
      var tmp=0;
      
      var len=blockb[0].length;
      for(var i=0; i<blockb[0].length; i++)
      {
        if(blockb[1][i] == val)
        {	
        	tmp = i;
        	break;
        }
      }
      if(blockb[1][tmp-1]==0 && blockb[1][tmp+1]==0)
      {
        blockb[0][tmp-1] = blockb[0][tmp-1] + blockb[0][tmp] + blockb[0][tmp+1];
        for(var i=tmp; i<len; i++)
        {
          blockb[0][i] = blockb[0][i+2];
          blockb[1][i] = blockb[1][i+2];
        }
        blockb[0].length -= 2;
      }
      else if(blockb[1][tmp-1]==0 && blockb[1][tmp+1]!=0)
      {
        blockb[0][tmp-1] = blockb[0][tmp-1] + blockb[0][tmp];
        for(var i=tmp; i<len; i++)
        {
          blockb[0][i] = blockb[0][i+1];
          blockb[1][i] = blockb[1][i+1];
        }
        blockb.length[0]--;
      }
      else if(blockb[1][tmp-1]!=0 && blockb[1][tmp+1]==0)
      {
        blockb[0][tmp] = blockb[0][tmp] + blockb[0][tmp+1];
        blockb[1][tmp] = 0;
        for(var i=tmp+1; i<len; i++)
        {
          blockb[0][i] = blockb[0][i+1];
          blockb[1][i] = blockb[1][i+1];
        }
        blockb[0].length--;
      }
      else
      	blockb[1][tmp] = 0;
      
     tmp = 0;
     len=blockw[0].length;
      for(var i=0; i<blockw[0].length; i++)
      {
        if(blockw[1][i] == val)
        {	
        	tmp = i;
        	break;
        }
      }
      if(blockw[1][tmp-1]==0 && blockw[1][tmp+1]==0)
      {
        blockw[0][tmp-1] = blockw[0][tmp-1] + blockw[0][tmp] + blockw[0][tmp+1];
        for(var i=tmp; i<len; i++)
        {
          blockw[0][i] = blockw[0][i+2];
          blockw[1][i] = blockw[1][i+2];
        }
        blockw[0].length -= 2;
      }
      else if(blockw[1][tmp-1]==0 && blockw[1][tmp+1]!=0)
      {
        blockw[0][tmp-1] = blockw[0][tmp-1] + blockw[0][tmp];
        for(var i=tmp; i<len; i++)
        {
          blockw[0][i] = blockw[0][i+1];
          blockw[1][i] = blockw[1][i+1];
        }
        blockw[0].length--;
      }
      else if(blockw[1][tmp-1]!=0 && blockw[1][tmp+1]==0)
      {
        blockw[0][tmp] = blockw[0][tmp] + blockw[0][tmp+1];
        blockw[1][tmp] = 0;
        for(var i=tmp+1; i<len; i++)
        {
          blockw[0][i] = blockw[0][i+1];
          blockw[1][i] = blockw[1][i+1];
        }
        blockw[0].length--;
      }
      else
      	blockw[1][tmp] = 0;
      
      tmp = 0;	
      len=blockf[0].length;
      for(var i=0; i<blockf[0].length; i++)
      {
        if(blockf[1][i] == val)
        {	
        	tmp = i;
        	break;
        }
      }
      if(blockf[1][tmp-1]==0 && blockf[1][tmp+1]==0)
      {
        blockf[0][tmp-1] = blockf[0][tmp-1] + blockf[0][tmp] + blockf[0][tmp+1];
        for(var i=tmp; i<len; i++)
        {
          blockf[0][i] = blockf[0][i+2];
          blockf[1][i] = blockf[1][i+2];
        }
        blockf[0].length -= 2;
      }
      else if(blockf[1][tmp-1]==0 && blockf[1][tmp+1]!=0)
      {
        blockf[0][tmp-1] = blockf[0][tmp-1] + blockf[0][tmp];
        for(var i=tmp; i<len; i++)
        {
          blockf[0][i] = blockf[0][i+1];
          blockf[1][i] = blockf[1][i+1];
        }
        blockf[0].length--;
      }
      else if(blockf[1][tmp-1]!=0 && blockf[1][tmp+1]==0)
      {
        blockf[0][tmp] = blockf[0][tmp] + blockf[0][tmp+1];
        blockf[1][tmp] = 0;
        for(var i=tmp+1; i<len; i++)
        {
          blockf[0][i] = blockf[0][i+1];
          blockf[1][i] = blockf[1][i+1];
        }
        blockf[0].length--;
      }
      else
      	blockf[1][tmp] = 0; 
      
      ext[val]=0;
      num--;
    }


    function step()
    {
      
      if(flag>=2)
        sub(del);
      else
        add(next);
	
		showBestfit();
		showWorstfit();
    	showFirstfit();
    	
    	flag = Math.floor(Math.random()*4);
    	if(flag >=2 && num > 3)
    	{
	    	del = Math.floor(Math.random()*(pro-1));
    		while(ext[del]==0)
    			del = Math.floor(Math.random()*(pro-1));
    	}
    	else
    	{
    		flag = 1;
    		next=Math.floor(Math.random()*400);
    		if(next<150)
    			next += 150;
    	}
    	mmsg();	
    	
    	//setTimeout("step()",1000);
    	
    }
    
    function clearr()
    {
    	sb.length=0;
    	sb=[2500];
    	bb.length=0;
    	bb= [0];
    	sw.length=0;
    	sw=[2500];
    	bw.length=0;
	  	bw= [0];
	  	sf.length=0;
    	sf=[2500];
    	bf.length=0;
    	bf= [0];

    	ext.length=0;
    	ext = [0];
    	
    	blockb=[sb,bb];
    	blockw=[sw,bw];
    	blockf=[sf,bf];
    	
    	pro = 1;
    	num = 0;
    	flag = 1;
    	
    	next=Math.floor(Math.random()*400);
    	if(next<150)
    		next += 150;
    	
    	showBestfit();
    	showWorstfit();
    	showFirstfit();
    	mmsg();
    }
  
  	function mmsg()
  	{
  		var mycontext7=document.getElementById("main").getContext('2d');
  		mycontext7.fillStyle='white';
  		mycontext7.fillRect(0,0,500,200);
  		mycontext7.strokeStyle='black';
    	mycontext7.strokeRect(0,0,500,200);
  		mycontext7.fillStyle='black';
  		mycontext7.font = '15pt Calibri';
  		if(flag >=2)
  			mycontext7.fillText( 'Next: Delete ID' + del , 100, 100);
  		else
    		mycontext7.fillText( 'Next: Add ' + next + 'KB', 100, 100);
  	}
  	
  	function startt()
  	{
  		step();
  		if(flagb==1 && flagw==1 && flagf==1)
  			timer = setTimeout("startt()",1000);
  	}
  	
  	function stopp()
  	{
  		clearTimeout(timer);
  	}
  	
</script>
</head>
<body>
<div style="margin-left:0px;">
<canvas id="main" width="500" height="200" 
    style="background-color:white;border: 3px black solid"></canvas>
    <div id="buttons">
    	<button onclick="startt()">Start</button>
    	<button onclick="stopp()">Stop</button>
    	<br  />
    	<button onclick="step()">Next</button>
		<button onclick="clearr()">Clear</button>
    </div>
<br />

<canvas id="text1" width="500" height="50" 
    style="background-color:white"></canvas>
<br />
<canvas id="bestfit" width="1250" height="100" 
    style="background-color:white;border: 3px black solid"></canvas>

<canvas id="text2" width="500" height="50" 
    style="background-color:white"></canvas>
<br />
<canvas id="worstfit" width="1250" height="100"
    style="background-color:white;border: 3px black solid"></canvas>

<canvas id="text3" width="500" height="50" 
    style="background-color:white"></canvas>
<br />
<canvas id="firstfit" width="1250" height="100" 
  style="background-color:white;border: 3px black solid"></canvas>

<br /><br />
</div>
</body>
</html>
