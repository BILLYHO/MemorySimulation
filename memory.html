<!DOCTYPE html>
<html>
<head>
<style>
#buttons {
    position: absolute;
    top: 150px;
    left: 380px;
}

p {
    font-family: "Calibri";
    font-size: 20px;
}

canvas{
    width: 1250px;
    height: 100px;
    background-color: white;
    border: 3px black solid;
}

canvas#main{
    width: 500px;
    height: 200px;
    background-color: white;
    border: 3px black solid;
}

</style>
<title>Memory Simulation</title>
<script>
    
    var bestFitBlockCSizeArr=[2500];
    var bestFitBlockIdArr= [0];
    var blockb=[bestFitBlockCSizeArr,bestFitBlockIdArr];
    
    var sw=[2500];
    var bw= [0];
    var blockw=[sw,bw];
    
    var sf=[2500];
    var bf= [0];
    var blockf=[sf,bf];

    var ext=[0];
    
    var pro = 1;
    var num = 0;
    var flag;
    var next;
    var del;
    var flagb,flagw,flagf;
    var timer;
    
    window.onload=function()
    {
        var mycontext1=document.getElementById("bestfit").getContext('2d');
        var mycontext2=document.getElementById("worstfit").getContext('2d');
        var mycontext3=document.getElementById("firstfit").getContext('2d');

        next=Math.floor(Math.random()*400);
        if(next<150)
            next += 150;
        flag = 1;
    

        showBlock("bestfit",blockb);
        showBlock("worstfit",blockw);
        showBlock("firstfit",blockf);
        mmsg();
    }

    function showBlock(name, block)
    {
        var mycontext=document.getElementById(name).getContext('2d');
        var sum = 0;
        for(var i=0; i < block[0].length; i++)
        {
            r = block[0][i]/2;
            if(block[1][i]==0)
            {
                mycontext.fillStyle='yellow';
                mycontext.fillRect(sum,0,r,100);
                mycontext.strokeStyle='black';
                mycontext.strokeRect(sum,0,r,100);
                mycontext.fillStyle='black';
                mycontext.font = '15pt Calibri';
                mycontext.textAlign='center';
                mycontext.fillText( r*2 + 'KB', sum+r/2, 50);
            }
            else
            {
                mycontext.fillStyle='red';
                mycontext.fillRect(sum,0,r,100);
                mycontext.strokeStyle='black';
                mycontext.strokeRect(sum,0,r,100);
                mycontext.fillStyle='black';
                mycontext.font = '15pt Calibri';
                mycontext.textAlign='center';
                mycontext.fillText( 'ID:' + blockb[1][i], sum+r/2, 30);
                mycontext.fillText( r*2 + 'KB', sum+r/2, 60);
            }
            sum += r;
        }
    }
 
    function add(val)
    {
        flagb = 0;
        var min=2500;
        for(var i=0; i<blockb[0].length; i++)
        {
            if(blockb[0][i]>=val && blockb[0][i]<min && blockb[1][i]==0)
                min = blockb[0][i];
        }
        for(var i=0; i<blockb[0].length; i++)
        {
            if(blockb[0][i] == min)
            {
                blockb[0].splice(i, 1, val, blockb[0][i]-val);
                blockb[1].splice(i, 0, pro);
                flagb=1;
                break;
            }
        }

        flagw = 0;
        var max = 0;
        for(var i=0; i<blockw[0].length; i++)
        {
            if (blockw[0][i] >= val && blockw[0][i] > max && blockw[1][i] == 0)
                max = blockw[0][i];
        }
        for(var i=0; i<blockw[0].length; i++)
        {
            if(blockw[0][i] == max)
            {
                blockw[0].splice(i, 1, val, blockw[0][i]-val);
                blockw[1].splice(i, 0, pro);
                flagw = 1;
                break;
            }
        }
        
        flagf = 0;
        for(var i=0; i<blockf[0].length; i++)
        {
            if(blockf[0][i] >= val && blockf[1][i]==0)
            {
                blockf[0].splice(i, 1, val, blockf[0][i]-val);
                blockf[1].splice(i, 0, pro);
                flagf = 1;
                break;
            }
        }
        
        ext.push(1);
        pro++;
        num++;
        
        if(flagb==0 && flagw==0 && flagf==0)
            alert("Best fit & Worst fit & First fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagb==0 && flagw==0)
            alert("Best fit & Worst fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagw==0 && flagf==0)
            alert("Worst fit & First fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagb==0 && flagf==0)
            alert("Best fit & First fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagb==0 )
            alert("Best fit has no more block for this process. Please kick 'clear' to restart.");
        else if(flagw==0 )
            alert("Worst fit has no more block for this process. Please kick 'clear' to restart.");
        else if(flagf==0 )
            alert("First fit has no more block for this process. Please kick 'clear' to restart.");

    }
    
    function sub(val)
    {
        var processToDelete = 0;
        for(var i=0; i<blockb[0].length; i++)
        {
            if(blockb[1][i] == val)
            {   
                processToDelete = i;
                break;
            }
        }
        remove(processToDelete, blockb);

      
        processToDelete = 0;
        for(var i=0; i<blockw[0].length; i++)
        {
            if(blockw[1][i] == val)
            {   
                processToDelete = i;
                break;
            }
        }
        remove(processToDelete, blockw);

      
        processToDelete = 0;
        for(var i=0; i<blockf[0].length; i++)
        {
            if(blockf[1][i] == val)
            {
                processToDelete = i;
                break;
            }
        }
        remove(processToDelete, blockf);

      
        ext[val]=0;
        num--;
    }

    function remove(processToDelete, block)
    {
        var total = 0;

        if(processToDelete > 0 && processToDelete < block[0].length - 1
            && block[1][processToDelete-1]==0 && block[1][processToDelete+1]==0)
        {
            total = block[0][processToDelete-1] + block[0][processToDelete] + block[0][processToDelete+1];
            block[0].splice(processToDelete-1, 3, total);
            block[1].splice(processToDelete, 2);
        }
        else if(processToDelete > 0 && block[1][processToDelete-1]==0
            && (processToDelete >= block[0].length -1 || block[1][processToDelete+1]!=0))
        {
            total = block[0][processToDelete-1] + block[0][processToDelete];
            block[0].splice(processToDelete-1, 2, total);
            block[1].splice(processToDelete,1);
        }
        else if( (processToDelete == 0 || block[1][processToDelete-1]!=0 )
            && processToDelete < block[0].length - 1 && block[1][processToDelete+1]==0)
        {
            total = block[0][processToDelete] + block[0][processToDelete+1];
            block[0].splice(processToDelete, 2, total);
            block[1].splice(processToDelete,1);
        }
        else
        {
            block[1][processToDelete] = 0;
        }
    }

    function step()
    {
        if(flag>=2)
            sub(del);
        else
            add(next);

        showBlock("bestfit",blockb);
        showBlock("worstfit",blockw);
        showBlock("firstfit",blockf);
        
        flag = Math.floor(Math.random()*4);
        if(flag >=2 && num > 3)
        {
            del = Math.floor(Math.random()*(pro-1));
            while(ext[del]==0)
                del = Math.floor(Math.random()*(pro-1));
        }
        else
        {
            flag = 1;
            next=Math.floor(Math.random()*400);
            if(next<150)
                next += 150;
        }
        mmsg();
    }
    
    function clearr()
    {
        bestFitBlockCSizeArr.length=0;
        bestFitBlockCSizeArr=[2500];
        bestFitBlockIdArr.length=0;
        bestFitBlockIdArr= [0];
        sw.length=0;
        sw=[2500];
        bw.length=0;
        bw= [0];
        sf.length=0;
        sf=[2500];
        bf.length=0;
        bf= [0];
        ext.length=0;
        ext = [0];
        
        blockb=[bestFitBlockCSizeArr,bestFitBlockIdArr];
        blockw=[sw,bw];
        blockf=[sf,bf];
        
        pro = 1;
        num = 0;
        flag = 1;
        
        next=Math.floor(Math.random()*400);
        if(next<150)
            next += 150;
        
        //showBestfit();
        showBlock("bestfit",blockb);
        //showWorstfit();
        showBlock("worstfit",blockw);
        //showFirstfit();
        showBlock("firstfit",blockf);
        mmsg();
    }
  
    function mmsg()
    {
        var mycontext7=document.getElementById("main").getContext('2d');
        mycontext7.fillStyle='white';
        mycontext7.fillRect(0,0,500,200);
        mycontext7.strokeStyle='black';
        mycontext7.strokeRect(0,0,500,200);
        mycontext7.fillStyle='black';
        mycontext7.font = '15pt Calibri';
        if(flag >=2)
            mycontext7.fillText( 'Next: Delete ID' + del , 100, 100);
        else
            mycontext7.fillText( 'Next: Add ' + next + 'KB', 100, 100);

//        var mycontext8=document.getElementById("test").getContext('2d');
//        mycontext8.fillStyle='white';
//        mycontext8.fillRect(0,0, 1250, 100);
//        mycontext8.fillStyle='black';
//        mycontext8.font = '15pt Calibri';
//        mycontext8.fillText(blockb[0].length, 50, 30);
//        mycontext8.fillText(blockb[1], 50, 50);
//        mycontext8.fillText(blockw[0].length, 250, 30);
//        mycontext8.fillText(blockw[1], 250, 50);
//        mycontext8.fillText(blockf[0].length, 450, 30);
//        mycontext8.fillText(blockf[1], 450, 50);
    }
    
    function startt()
    {
        step();
        if(flagb==1 && flagw==1 && flagf==1)
            timer = setTimeout("startt()",1000);
    }
    
    function stopp()
    {
        clearTimeout(timer);
    }
    
</script>
</head>
<body>

<div style="margin-left:0px;">
    <canvas id="main" width="500" height="200"></canvas>
    <div id="buttons">
        <button onclick="startt()">Start</button>
        <button onclick="stopp()">Stop</button>
        <br/>
        <button onclick="step()">Next</button>
        <button onclick="clearr()">Clear</button>
    </div>
    <!--
    <canvas id="test" width="1250" height="100"></canvas>
    -->

    <p>Best Fit</p>
    <canvas id="bestfit" width="1250" height="100" ></canvas>

    <p>Worst Fit</p>
    <canvas id="worstfit" width="1250" height="100"></canvas>

    <p>First Fit</p>
    <canvas id="firstfit" width="1250" height="100" ></canvas>
</div>

</body>
</html>