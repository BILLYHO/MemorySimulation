<!DOCTYPE html>
<html>
<head>
<style>
#buttons {
    position: absolute;
    top: 150px;
    left: 380px;
}

p {
    font-family: "Calibri";
    font-size: 20px;
}

canvas{
    width: 1250px;
    height: 100px;
    background-color: white;
    border: 3px black solid;
}

canvas#main{
    width: 500px;
    height: 200px;
    background-color: white;
    border: 3px black solid;
}

</style>
<title>Memory Simulation</title>
<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
<script>
    
    var bestFitBlockCSizeArr=[2500];
    var bestFitBlockIdArr= [0];
    var blockb=[bestFitBlockCSizeArr,bestFitBlockIdArr];
    
    var sw=[2500];
    var bw= [0];
    var blockw=[sw,bw];
    
    var sf=[2500];
    var bf= [0];
    var blockf=[sf,bf];

    var ext=[0];
    
    var pro = 1;
    var num = 0;
    var flag;
    var next;
    var del;
    var flagb,flagw,flagf;
    var timer;
    
    window.onload=function()
    {
    var mycontext1=document.getElementById("bestfit").getContext('2d');
    var mycontext2=document.getElementById("worstfit").getContext('2d');
    var mycontext3=document.getElementById("firstfit").getContext('2d');

    next=Math.floor(Math.random()*400);
    if(next<150)
        next += 150;
    flag = 1;
    

    showBlock("bestfit",blockb);
    showBlock("worstfit",blockw);
    showBlock("firstfit",blockf);

    //showBestfit();
    //showWorstfit();
    //showFirstfit();
    mmsg();
    }

    function showBlock(name, block)
    {
        var mycontext=document.getElementById(name).getContext('2d');
        var sum = 0;
        for(var i=0; i < block[0].length; i++)
        {
            r = block[0][i]/2;
            if(block[1][i]==0)
            {
                mycontext.fillStyle='yellow';
                mycontext.fillRect(sum,0,r,100);
                mycontext.strokeStyle='black';
                mycontext.strokeRect(sum,0,r,100);
                mycontext.fillStyle='black';
                mycontext.font = '15pt Calibri';
                mycontext.textAlign='center';
                mycontext.fillText( r*2 + 'KB', sum+r/2, 50);
            }
            else
            {
                mycontext.fillStyle='red';
                mycontext.fillRect(sum,0,r,100);
                mycontext.strokeStyle='black';
                mycontext.strokeRect(sum,0,r,100);
                mycontext.fillStyle='black';
                mycontext.font = '15pt Calibri';
                mycontext.textAlign='center';
                mycontext.fillText( 'ID:' + blockb[1][i], sum+r/2, 30);
                mycontext.fillText( r*2 + 'KB', sum+r/2, 60);
            }
            sum += r;
        }
    }


    
    function add(val)
    {
        flagb = 0;
        var min=2500;
        for(var i=0; i<bestFitBlockCSizeArr.length; i++)
        {
            if(bestFitBlockCSizeArr[i]>=val && bestFitBlockCSizeArr[i]<min && blockb[1][i]==0)
                min = bestFitBlockCSizeArr[i];
        }
        for(var i=0; i<bestFitBlockCSizeArr.length; i++)
        {
            if(bestFitBlockCSizeArr[i] == min)
            {
                for(var j=bestFitBlockCSizeArr.length; j>i; j--)
                {
                    bestFitBlockCSizeArr[j] = bestFitBlockCSizeArr[j-1];
                    blockb[1][j] = blockb[1][j-1];
                }
                
                bestFitBlockCSizeArr[i+1] = bestFitBlockCSizeArr[i]-val;
                blockb[1][i+1] = 0;
                
                bestFitBlockCSizeArr[i] = val;
                blockb[1][i] = pro;
                flagb=1;
                break;
            }
        }
      flagw = 0;
      var max = 0;
      for(var i=0; i<blockw[0].length; i++)
      {
        if(blockw[0][i]>=val && blockw[0][i]>max && blockw[1][i]==0)
          max = blockw[0][i];
      }
      
        for(var i=0; i<blockw[0].length; i++)
        {
            if(blockw[0][i] == max)
            {
                for(var j=blockw[0].length; j>i; j--)
                {
                    blockw[0][j] = blockw[0][j-1];
                    blockw[1][j] = blockw[1][j-1];
                }
                
                blockw[0][i+1] = blockw[0][i]-val;
                blockw[1][i+1] = 0;
                
                blockw[0][i] = val;
                blockw[1][i] = pro;
                flagw = 1;
                break;
            }
        }
        
        flagf = 0;
        for(var i=0; i<blockf[0].length; i++)
        {
            if(blockf[0][i] >= val && blockf[1][i]==0)
            {
                for(var j=blockf[0].length; j>i; j--)
                {
                    blockf[0][j] = blockf[0][j-1];
                    blockf[1][j] = blockf[1][j-1];
                }
                
                blockf[0][i+1] = blockf[0][i]-val;
                blockf[1][i+1] = 0;
                
                blockf[0][i] = val;
                blockf[1][i] = pro;
                flagf = 1;
                break;
            }
        }
        ext.push(1);
        pro++;
        num++;
        
        if(flagb==0 && flagw==0 && flagf==0)
            alert("Best fit & Worst fit & First fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagb==0 && flagw==0)
            alert("Best fit & Worst fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagw==0 && flagf==0)
            alert("Worst fit & First fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagb==0 && flagf==0)
            alert("Best fit & First fit have no more block for this process. Please kick 'clear' to restart.");
        else if(flagb==0 )
            alert("Best fit has no more block for this process. Please kick 'clear' to restart.");
        else if(flagw==0 )
            alert("Worst fit has no more block for this process. Please kick 'clear' to restart.");
        else if(flagf==0 )
            alert("First fit has no more block for this process. Please kick 'clear' to restart.");

    }
    
    function sub(val)
    {
      var tmp=0;
      
      var len=bestFitBlockCSizeArr.length;
      for(var i=0; i<bestFitBlockCSizeArr.length; i++)
      {
        if(blockb[1][i] == val)
        {   
            tmp = i;
            break;
        }
      }
      if(blockb[1][tmp-1]==0 && blockb[1][tmp+1]==0)
      {
        bestFitBlockCSizeArr[tmp-1] = bestFitBlockCSizeArr[tmp-1] + bestFitBlockCSizeArr[tmp] + bestFitBlockCSizeArr[tmp+1];
        for(var i=tmp; i<len; i++)
        {
          bestFitBlockCSizeArr[i] = bestFitBlockCSizeArr[i+2];
          blockb[1][i] = blockb[1][i+2];
        }
        bestFitBlockCSizeArr.length -= 2;
      }
      else if(blockb[1][tmp-1]==0 && blockb[1][tmp+1]!=0)
      {
        bestFitBlockCSizeArr[tmp-1] = bestFitBlockCSizeArr[tmp-1] + bestFitBlockCSizeArr[tmp];
        for(var i=tmp; i<len; i++)
        {
          bestFitBlockCSizeArr[i] = bestFitBlockCSizeArr[i+1];
          blockb[1][i] = blockb[1][i+1];
        }
        bestFitBlockCSizeArr.length--;
      }
      else if(blockb[1][tmp-1]!=0 && blockb[1][tmp+1]==0)
      {
        bestFitBlockCSizeArr[tmp] = bestFitBlockCSizeArr[tmp] + bestFitBlockCSizeArr[tmp+1];
        blockb[1][tmp] = 0;
        for(var i=tmp+1; i<len; i++)
        {
          bestFitBlockCSizeArr[i] = bestFitBlockCSizeArr[i+1];
          blockb[1][i] = blockb[1][i+1];
        }
        bestFitBlockCSizeArr.length--;
      }
      else
        blockb[1][tmp] = 0;
      
     tmp = 0;
     len=blockw[0].length;
      for(var i=0; i<blockw[0].length; i++)
      {
        if(blockw[1][i] == val)
        {   
            tmp = i;
            break;
        }
      }
      if(blockw[1][tmp-1]==0 && blockw[1][tmp+1]==0)
      {
        blockw[0][tmp-1] = blockw[0][tmp-1] + blockw[0][tmp] + blockw[0][tmp+1];
        for(var i=tmp; i<len; i++)
        {
          blockw[0][i] = blockw[0][i+2];
          blockw[1][i] = blockw[1][i+2];
        }
        blockw[0].length -= 2;
      }
      else if(blockw[1][tmp-1]==0 && blockw[1][tmp+1]!=0)
      {
        blockw[0][tmp-1] = blockw[0][tmp-1] + blockw[0][tmp];
        for(var i=tmp; i<len; i++)
        {
          blockw[0][i] = blockw[0][i+1];
          blockw[1][i] = blockw[1][i+1];
        }
        blockw[0].length--;
      }
      else if(blockw[1][tmp-1]!=0 && blockw[1][tmp+1]==0)
      {
        blockw[0][tmp] = blockw[0][tmp] + blockw[0][tmp+1];
        blockw[1][tmp] = 0;
        for(var i=tmp+1; i<len; i++)
        {
          blockw[0][i] = blockw[0][i+1];
          blockw[1][i] = blockw[1][i+1];
        }
        blockw[0].length--;
      }
      else
        blockw[1][tmp] = 0;
      
      tmp = 0;  
      len=blockf[0].length;
      for(var i=0; i<blockf[0].length; i++)
      {
        if(blockf[1][i] == val)
        {   
            tmp = i;
            break;
        }
      }
      if(blockf[1][tmp-1]==0 && blockf[1][tmp+1]==0)
      {
        blockf[0][tmp-1] = blockf[0][tmp-1] + blockf[0][tmp] + blockf[0][tmp+1];
        for(var i=tmp; i<len; i++)
        {
          blockf[0][i] = blockf[0][i+2];
          blockf[1][i] = blockf[1][i+2];
        }
        blockf[0].length -= 2;
      }
      else if(blockf[1][tmp-1]==0 && blockf[1][tmp+1]!=0)
      {
        blockf[0][tmp-1] = blockf[0][tmp-1] + blockf[0][tmp];
        for(var i=tmp; i<len; i++)
        {
          blockf[0][i] = blockf[0][i+1];
          blockf[1][i] = blockf[1][i+1];
        }
        blockf[0].length--;
      }
      else if(blockf[1][tmp-1]!=0 && blockf[1][tmp+1]==0)
      {
        blockf[0][tmp] = blockf[0][tmp] + blockf[0][tmp+1];
        blockf[1][tmp] = 0;
        for(var i=tmp+1; i<len; i++)
        {
          blockf[0][i] = blockf[0][i+1];
          blockf[1][i] = blockf[1][i+1];
        }
        blockf[0].length--;
      }
      else
        blockf[1][tmp] = 0; 
      
      ext[val]=0;
      num--;
    }
    function step()
    {
      
      if(flag>=2)
        sub(del);
      else
        add(next);
    
        //showBestfit();
        showBlock("bestfit",blockb);
        //showWorstfit();
        showBlock("worstfit",blockw);
        //showFirstfit();
        showBlock("firstfit",blockf);
        
        flag = Math.floor(Math.random()*4);
        if(flag >=2 && num > 3)
        {
            del = Math.floor(Math.random()*(pro-1));
            while(ext[del]==0)
                del = Math.floor(Math.random()*(pro-1));
        }
        else
        {
            flag = 1;
            next=Math.floor(Math.random()*400);
            if(next<150)
                next += 150;
        }
        mmsg(); 
        
        //setTimeout("step()",1000);
        
    }
    
    function clearr()
    {
        bestFitBlockCSizeArr.length=0;
        bestFitBlockCSizeArr=[2500];
        bestFitBlockIdArr.length=0;
        bestFitBlockIdArr= [0];
        sw.length=0;
        sw=[2500];
        bw.length=0;
        bw= [0];
        sf.length=0;
        sf=[2500];
        bf.length=0;
        bf= [0];
        ext.length=0;
        ext = [0];
        
        blockb=[bestFitBlockCSizeArr,bestFitBlockIdArr];
        blockw=[sw,bw];
        blockf=[sf,bf];
        
        pro = 1;
        num = 0;
        flag = 1;
        
        next=Math.floor(Math.random()*400);
        if(next<150)
            next += 150;
        
        //showBestfit();
        showBlock("bestfit",blockb);
        //showWorstfit();
        showBlock("worstfit",blockw);
        //showFirstfit();
        showBlock("firstfit",blockf);
        mmsg();
    }
  
    function mmsg()
    {
        var mycontext7=document.getElementById("main").getContext('2d');
        mycontext7.fillStyle='white';
        mycontext7.fillRect(0,0,500,200);
        mycontext7.strokeStyle='black';
        mycontext7.strokeRect(0,0,500,200);
        mycontext7.fillStyle='black';
        mycontext7.font = '15pt Calibri';
        if(flag >=2)
            mycontext7.fillText( 'Next: Delete ID' + del , 100, 100);
        else
            mycontext7.fillText( 'Next: Add ' + next + 'KB', 100, 100);
    }
    
    function startt()
    {
        step();
        if(flagb==1 && flagw==1 && flagf==1)
            timer = setTimeout("startt()",1000);
    }
    
    function stopp()
    {
        clearTimeout(timer);
    }
    
</script>
</head>
<body>

<div style="margin-left:0px;">
    <canvas id="main" width="500" height="200"></canvas>
    <div id="buttons">
        <button onclick="startt()">Start</button>
        <button onclick="stopp()">Stop</button>
        <br/>
        <button onclick="step()">Next</button>
        <button onclick="clearr()">Clear</button>
    </div>

    <p>Best Fit</p>
    <canvas id="bestfit" width="1250" height="100" ></canvas>

    <p>Worst Fit</p>
    <canvas id="worstfit" width="1250" height="100"></canvas>

    <p>First Fit</p>
    <canvas id="firstfit" width="1250" height="100" ></canvas>
</div>

</body>
</html>